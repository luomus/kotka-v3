<ng-container *ngIf="context">
  <div style="display: flex">
    <div style="flex: 1">
      <ng-container *ngIf="context.ownerOrganization as ownerOrganization">
        {{ ownerOrganization.organizationLevel2 }}
        <br>
        {{ ownerOrganization.organizationLevel3 }}<ng-container *ngIf="ownerOrganization.abbreviation"> ({{ ownerOrganization.abbreviation }})</ng-container>
        <br>
        {{ ownerOrganization.organizationLevel4 }}
      </ng-container>
    </div>
    <div style="flex: 0; text-align: center">
      LOGO
    </div>
    <div style="flex: 1; text-align: right">
      <img [src]="'https://koivu.luomus.fi/projects/qrcode/?code=' + (data.id | toFullUri)" width="50" height="50">
      <br>
      {{ data.id | toFullUri }}
    </div>
  </div>
  <h2>{{ data.type | transactionTypeLabel | uppercase }}</h2>
  <p>We are sending you the material indicated here. Upon receiving the specimens/data, please sign and return one copy of this form to the above address<ng-container *ngIf="data.localHandlerEmail"> or email to {{ data.localHandlerEmail }}</ng-container>. This form, along with the attachments, constitutes the full loan agreement.</p>
  <p>Please reference the identifier {{ data.id | toFullUri }} in all correspondence related to this material.</p>
  <p>Please cite specimens/data using their unique identifiers and inform us about publications based on this material. If you image (photograph, scan) the specimens, send the digital files to us by email. See attachments for more information.</p>
  <p>All {{ data.type | transactionTypeLabel }}s are governed by our terms and conditions as outlined in the attached documents. </p>
  <h4>Attached documents:</h4>
  <div style="display: grid; grid-template-columns: 50% 50%">
    <div>
      [&nbsp;&nbsp;]&nbsp;&nbsp; {{ data.type | transactionTypeLabel | titlecase }} terms<br>
      [&nbsp;&nbsp;]&nbsp;&nbsp; Additional loan terms<br>
      [&nbsp;&nbsp;]&nbsp;&nbsp; Specimen data (printout or file by email)<br>
      [&nbsp;&nbsp;]&nbsp;&nbsp; Permits
    </div>
    <div>
      [&nbsp;&nbsp;]&nbsp;&nbsp; Instructions on returning the material<br>
      [&nbsp;&nbsp;]&nbsp;&nbsp; Other:
    </div>
  </div>
  <hr>
  <div class="avoid-page-break" style="display: grid; grid-template-columns: 50% 50%">
    <div>
      <h4>Recipient</h4>
      <p *ngIf="context.correspondingOrganization as correspondingOrganization">
        {{ correspondingOrganization.organizationLevel2 }}
        <br>
        {{ correspondingOrganization.organizationLevel3 }}<ng-container *ngIf="correspondingOrganization.abbreviation"> ({{ correspondingOrganization.abbreviation }})</ng-container>
        <br>
        {{ correspondingOrganization.organizationLevel4 }}
      </p>
      <p>
        Corresponding person:<br>
        {{ data.correspondentPerson }}
      </p>
      <p>
        Receiving researcher:<br>
        {{ data.correspondentResearcher }}
      </p>
    </div>
    <div>
      <h4>{{ data.type | transactionTypeLabel | titlecase }} ID: {{ data.id | toFullUri }}</h4>
      <h4>Due date: {{ data.dueDate | date:'dd MMMM Y' }}</h4>
      <p>
        Handler:<br>
        {{ data.localHandler }}<br>
        {{ data.localHandlerEmail }}
      </p>
      <p>
        Person responsible:<br>
        {{ data.localPerson }}<br>
        {{ data.localPersonEmail }}
      </p>
      <p>
        Loan request received: {{ data.requestReceived | date:'dd MMMM Y' }}<br>
        Send to you on: {{ data.outgoingSent | date:'dd MMMM Y' }}<br>
        Sent by: {{ fieldData['transportMethod']['options']['value_options'][data.transportMethod || ''] }}
      </p>
    </div>
  </div>
  <hr>
  <div class="avoid-page-break">
    <h4>Remarks</h4>
    <p>{{ data.publicRemarks }}</p>
  </div>
  <hr>
  <div class="avoid-page-break">
    <p>Material received in good condition. We commit to the {{ data.type | transactionTypeLabel }} terms.</p>
    <div style="display: grid; grid-template-columns: 35% 35% 15% 15%">
      <span>Recipient name</span>
      <span>Signature</span>
      <span>Place</span>
      <span>Date</span>
    </div>
  </div>
  <hr>
  <div class="avoid-page-break">
    <h4>Material</h4>
    <h4>Total number of specimens: {{ totalAwayCount }}</h4>
    <p>{{ data.material }}</p>
    <div style="display: grid; grid-template-columns: repeat(3, 33%)">
      <span *ngFor="let awayID of data.awayIDs">{{ awayID }}</span>
    </div>
    <p>In addition, loan includes {{ data.awayCount }} specimen(s) not specified in this list.</p>
  </div>
</ng-container>
